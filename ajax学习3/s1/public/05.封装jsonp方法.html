<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <button id="btn">点我发送请求</button>
    <script>
        // function fn2 (data) {
        //     console.log('客户端的函数被调用了');
        //     console.log(data);
        // }
    </script>
    <!-- 将非同源服务器端的请求地址写在script标签的src属性中  -->
    <script type="text/javascript">
       var btn = document.querySelector('#btn');
       btn.onclick = function() {
           jsonp({
              // 请求地址
              url: 'http://localhost:3001/better',
              data: {
                  name: 'lisi',
                  age: 30
              },
              success: function(data) {
                console.log(data);
              }
            })
       }

       function jsonp(options) {
           // 动态创建script标签
           var script = document.createElement('script');
           // 拼接字符串的变量
           var params = '';
           for(var attr in options.data) {
               params += '&' + attr + '=' + options.data[attr];
           }
           
           //0-1
           var fnName = 'myJsonp' + Math.random().toString().replace('.','');

           // 函数已经不是一个全局函数
           // 我们要想办法将函数变为全局函数，否则服务器返回会出现问题
           window[fnName] = options.success;
           
           // 为script标签添加src属性
           script.src = options.url + '?callback=' + fnName + params;
           // 将标签追加到页面中
           document.body.appendChild(script);
           script.onload = function() {
            document.body.removeChild(this);
           }
       }
       
    </script>

</body>
</html>